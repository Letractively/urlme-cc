@model ianhd.admin.ViewModels.SiteFeatureIndex
@using ianhd.core.Extensions

@{
    // TODO: appropr title
    ViewBag.Title = "SiteFeatures";
}

<div id="siteFeatureIndex">
    <h2>> SiteFeatures</h2>
    @using (Html.BeginForm("Index", "SiteFeature", FormMethod.Post))
    {
        @Html.HiddenFor(m => m.NewSiteFeature.Archive)
        // more hiddens?
    
        @Html.TextAreaFor(m => m.NewSiteFeature.Value, new { placeholder="Enter tagline...", maxlength = "250", @class = "input", autofocus="autofocus", max_value_length=Model.NewSiteFeature.SiteFeatureCategory.FeatureCategory.MaxValueLength })
        <div class="buttonset">
            <span>When?</span>
            <input type="radio" name="buttonset" id="step1_startWhenever" value="startWhenever" /><label for="step1_startWhenever">Whenever</label>
            <input type="radio" name="buttonset" id="step1_specificDates" value="specificDates" /><label for="step1_specificDates">Specific days</label>
            
            @*<span>Starting</span><input type="checkbox" id="startWhenever" data-bind="checked: startWhenever" /><label for="startWhenever">Whenever</label><input data-bind="enable: !startWhenever()" type="date" class="input" name="NewSiteFeature.StartDate" value="@(Model.NewSiteFeature.StartDate.HasValue ? Model.NewSiteFeature.StartDate.Value.ToString("yyyy-MM-dd") : "")" />*@
        </div>
        <div data-bind="visible: !startWhenever()">
            <span>Last day</span><input type="checkbox" id="noEndDate" data-bind="checked: noEndDate" /><label for="noEndDate">No end date</label><input data-bind="enable: !noEndDate()" type="date" class="input" name="NewSiteFeature.LastDate" value="@(Model.NewSiteFeature.LastDate.HasValue ? Model.NewSiteFeature.LastDate.Value.ToString("yyyy-MM-dd") : "")" />
        </div>        
        <div id="controls">
            <button class="blueButton" type="submit">Save</button> or <a href="onclick:location.reload();return false;" class="cancel">Cancel</a>
        </div>
    }

    <div id="siteFeatures" data-bind="foreach: siteFeatures">
        <div data-bind="attr: { id: SiteFeatureId }">
            <span data-bind="text: Value"></span> - <a href="~/sitefeature/delete/tagline.SiteFeatureId" onclick="alert('working on delete links...'); return false;" class="delete">Delete</a>
        </div>
    </div>
</div>

<script>
    var data = {};

    var startWheneverKey = "startWhenever";
    var noEndDateKey = "noEndDate";
    var savedStartWhenever = localStorage.getItem(startWheneverKey);
    var savedNoEndDate = localStorage.getItem(noEndDateKey);

    data.startWhenever = savedStartWhenever === null || savedStartWhenever === "true";
    data.noEndDate = savedNoEndDate === null || savedNoEndDate === "true";
    data.siteFeatures = @Html.Raw(Model.SiteFeatures.OrderByDescending(x => x.CreateDate).ToJson());

    var viewModel = ianhd.pluginHelpers.ko.getViewModel(data);

    // bind this thing    ianhd.pluginHelpers.ko.bind(viewModel);    viewModel.startWhenever.subscribe(function (val) {
        // TODO: remove all console log's
        console.log("subscribe startWhenever");
        localStorage.setItem(startWheneverKey, val);
        // update viewModel's startDate, and endDate for that matter
    });

    viewModel.noEndDate.subscribe(function (val) {
        console.log("subscribe noEndDate");
        localStorage.setItem(noEndDateKey, val);
    });</script>
@Scripts.Render("~/scripts/ianhd/ianhd.siteFeature.index.js")
