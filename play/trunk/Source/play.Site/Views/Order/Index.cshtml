@model play.Site.Models.PlayOrder

@section desktopBody {
    @{ Html.RenderPartial("OrderForm", "dt"); }
}

@section mobileBody {
    @{ Html.RenderPartial("OrderForm", "m"); }
}

@section scripts {
<script>
    var updateOrderTotal = function (order) {
        var envId = order.hasClass("m") ? "#m_" : "#dt_";
        var payButton = order.hasClass("m") ? $(".payButton.m form") : $(".payButton.dt form");
        var indivTicketTotal = parseInt($(envId + "coupleTotal").text());
        var coupleTicketTotal = parseInt($(envId + "individualTotal").text());
        var ticketTotal = indivTicketTotal + coupleTicketTotal;
        
        if (!ticketTotal) {
            payButton.hide();
            return;
        } else {
            payButton.show();
        }

        // paypal button controls
        var hidAmount = $("[name='amount']");
        hidAmount.val(ticketTotal);
        hidAmount.val("0.01");
    };

    $(function () {
        $(".buttonset").buttonset();
        updateOrderTotal($(".orderIndex.m"));
        updateOrderTotal($(".orderIndex.dt"));

        // bind controls

        // change play date, deselect all selections in document
        $("input[name='playDate']").change(function () {
            document.getSelection().removeAllRanges();
        });

        // click a counter up/down (+/-) button
        $(".countButton").click(function (e) {
            e.preventDefault();
            var btn = $(this);
            var countUp = btn.hasClass("countUp");
            var counter = btn.closest(".counter");
            var display = $("." + counter.attr("data-display-class"));
            var total = $("#" + counter.attr("data-total-id"));
            var pricePer = parseInt($("#" + counter.attr("data-price-per-id")).text());
            var currentCount = parseInt(display.first().text());
            if (!currentCount && !countUp)
                return; // zero. can't get lower than zero.
            if (countUp) {
                currentCount++;
            } else {
                currentCount--;
            }
            display.text(currentCount);
            total.text(currentCount * pricePer);
            clearSelection();
            updateOrderTotal(counter.closest(".orderIndex"));
        });
    });
</script>
}
